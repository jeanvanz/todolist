<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: script.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: script.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const tasks = loadLocalData('savedTasks') || [];
const taskListElement = document.getElementById("taskListElement");
const emptyTaskListElement = document.getElementById("emptyTaskListElement");
const frmTask = document.getElementById('frmTask');

/**
 * Creates an random id to implement in the tasks
 * 
 * @returns {number}
 */
function newId() {
    return Math.floor(Math.random() * 1000);
}

/**
 * Gives you the list of tasks
 * 
 * @returns {*}
 */
function getTasks() {
    return tasks;
}


function getTaskById(taskId) {
    const taskIndex = getIndexByTaskId(taskId);

    return tasks[taskIndex] || undefined;
}

function getIndexByTaskId(taskId) {
    return tasks.findIndex((task) => task.id == taskId);
}

/**
 * Create a task using the id generated by the function newId and create the Object task based on what the user informed
 * 
 * @param {string} taskTitle 
 * @param {string} taskDescription 
 * @returns {Object} return the new task created
 */
function createTask(taskTitle, taskDescription = "") {
    let id = newId();

    let task = {
        id,
        taskTitle,
        taskDescription,
    }

    tasks.push(task);

    saveLocalData('savedTasks', tasks);

    renderTasks();

    return task;
}

function deleteTask(taskId) {
    const taskIndex = getIndexByTaskId(taskId);
    tasks.splice(taskIndex, 1);

    saveLocalData('savedTasks', tasks);

    renderTasks();
}

function updateTask(task = {}) {
    try {
        const taskIndex = getIndexByTaskId(task.id);

        tasks[taskIndex] = {
            ...tasks[taskIndex],
            ...task,
        };

        frmTask.frmAction.value = 'NEW_TASK';

        saveLocalData('savedTasks', tasks);

        renderTasks();
        return tasks[taskIndex];
    } catch (e) {
        console.log(e);
        return undefined;
    }
}

function renderFormUpdate(taskId = -1) {
    try {
        const taskIndex = getIndexByTaskId(taskId);
        const task = tasks[taskIndex];

        frmTask.frmTaskId.value = task.id;
        frmTask.txtTaskTitle.value = task.taskTitle;
        frmTask.txtTaskDescription.value = task.taskDescription;
        frmTask.frmAction.value = 'UPDATE_TASK';
        frmTask.txtTaskTitle.focus();

    } catch (e) {
        console.log(e);
        alert("Erro ao editar task");
    }
}

function renderTasks(listElement = taskListElement, emptyMessage = emptyTaskListElement) {
    let finalHtml = "";

    if (tasks.length === 0) {
        emptyMessage.style.display = 'block';
        listElement.style.display = 'none';
        return;
    }

    emptyMessage.style.display = 'none';
    listElement.style.display = 'flex';

    tasks.forEach(function (item) {
        finalHtml += `
            &lt;details class="taskItem">
                &lt;summary class="taskTitle">
                    ${item.taskTitle}
                &lt;/summary>
                ${item.taskDescription}
                &lt;div>
                    &lt;button
                        class="btn"
                        onclick="if (confirm('Tem certeza')) deleteTask(${item.id})"
                    >
                        Pronto
                    &lt;/button>
                    &lt;button
                        class="btn btn-info"
                        onclick="renderFormUpdate(${item.id})"
                    >
                        Alterar
                    &lt;/button>
                &lt;/div>
            &lt;/details>
        `;
    });

    listElement.innerHTML = finalHtml;
}

frmTask.addEventListener('submit', function (event) {
    event.preventDefault();

    if (frmTask.frmAction.value === "NEW_TASK") {
        createTask(frmTask.txtTaskTitle.value, frmTask.txtTaskDescription.value);
        frmTask.reset();
        return;
    }

    updateTask({
        id: frmTask.frmTaskId.value,
        taskTitle: frmTask.txtTaskTitle.value,
        taskDescription: frmTask.txtTaskDescription.value
    });

    frmTask.reset();
})

function saveLocalData(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
}

function loadLocalData(key) {
    const dataString = localStorage.getItem(key);
    return JSON.parse(dataString);
}

renderTasks();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#getTasks">getTasks</a></li><li><a href="global.html#newId">newId</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Feb 18 2024 19:17:18 GMT-0300 (Horário Padrão de Brasília)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
